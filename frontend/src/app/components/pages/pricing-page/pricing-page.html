<div class="pricing-page">
  <div class="pricing-container">
    <!-- Page Header -->
    <div class="page-header">
      <h1 class="page-title">Pricing</h1>
      <p class="page-subtitle">Transparent pricing for all our services</p>
    </div>

    <!-- View Switcher -->
    <div class="view-switcher">
      <span class="view-label">Services</span>
      <button
        class="view-btn calculator-btn"
        [class.active]="showCalculator"
        (click)="toggleCalculator()">
        Calculator
      </button>
    </div>

    <!-- Category Selector -->
    <div class="category-selector">
      <button
        class="category-btn"
        [class.active]="isCategorySelected('dentistry')"
        (click)="selectCategory('dentistry')">
        Dentistry
      </button>
      <button
        class="category-btn"
        [class.active]="isCategorySelected('aesthetic')"
        (click)="selectCategory('aesthetic')">
        Aesthetic Medicine
      </button>
    </div>

    <!-- Content Wrapper for Services and Calculator -->
    <div class="content-wrapper">
      <!-- Services View (Specializations) -->
      <div class="services-section">
        @if (selectedCategoryId) {
          <div class="services-view">
            @for (specialization of getSelectedCategory()?.specializations; track specialization.id) {
              <div class="specialization-section">
                <!-- Specialization Header -->
                <button
                  class="specialization-header"
                  (click)="toggleSpecialization(specialization.id, $event)">
                  <h3>{{ specialization.name }}</h3>
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    width="20"
                    height="20"
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2"
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    [class.rotated]="isSpecializationExpanded(specialization.id)">
                    <polyline points="6 9 12 15 18 9"></polyline>
                  </svg>
                </button>

                <!-- Items -->
                @if (isSpecializationExpanded(specialization.id)) {
                  <div class="items-list">
                    @for (item of specialization.items; track item.id) {
                      <div
                        class="price-item"
                        (click)="addToCart(item, specialization, getSelectedCategory()!)">
                        <span class="item-name">{{ item.name }}</span>
                        <div class="item-right">
                          <span class="item-price">€{{ item.price }}</span>
                          @if (isItemInCart(item.id)) {
                            <svg
                              class="checkmark"
                              xmlns="http://www.w3.org/2000/svg"
                              width="20"
                              height="20"
                              viewBox="0 0 24 24"
                              fill="none"
                              stroke="currentColor"
                              stroke-width="3"
                              stroke-linecap="round"
                              stroke-linejoin="round">
                              <polyline points="20 6 9 17 4 12"></polyline>
                            </svg>
                          }
                        </div>
                      </div>
                    }
                  </div>
                }
              </div>
            }
          </div>
        }
      </div>

      <!-- Calculator/Cart View (always below services) -->
      @if (showCalculator) {
        <div class="calculator-view">
          @if (cart.length === 0) {
            <div class="empty-cart">
              <p>No items selected</p>
              <button class="back-to-services" (click)="toggleCalculator()">
                Hide Calculator
              </button>
            </div>
          } @else {
            <div class="cart-content">
              <!-- Cart Items -->
              <div class="cart-items">
                @for (cartItem of cart; track cartItem.item.id) {
                  <div class="cart-item">
                    <div class="cart-item-info">
                      <span class="cart-item-name">{{ cartItem.item.name }}</span>
                      <span class="cart-item-category">{{ cartItem.specialization }}</span>
                    </div>
                    <div class="cart-item-right">
                      <button
                        class="cart-item-quantity-btn"
                        (click)="openQuantityDialog(cartItem, $event)">
                        {{ cartItem.quantity }}x
                      </button>
                      <span class="cart-item-price">€{{ cartItem.item.price * cartItem.quantity }}</span>
                      <button
                        class="remove-btn"
                        (click)="removeFromCart(cartItem)">
                        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                          <polyline points="3 6 5 6 21 6"></polyline>
                          <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                        </svg>
                      </button>
                    </div>
                  </div>
                }
              </div>

              <!-- Total Section -->
              <div class="cart-total">
                <span class="total-label">Total</span>
                <span class="total-amount">€{{ getTotalPrice() }}</span>
              </div>

              <!-- Discard All Button -->
              <button class="discard-all-btn" (click)="discardAll()">
                Discard All Items
              </button>
            </div>
          }
        </div>
      }
    </div>
  </div>

  <!-- Quantity Editor Dialog -->
  @if (showQuantityDialog && editingCartItem) {
    <div class="dialog-overlay" (click)="closeQuantityDialog()">
      <div class="dialog-content" (click)="$event.stopPropagation()">
        <h3 class="dialog-title">Edit Quantity</h3>
        <p class="dialog-item-name">{{ editingCartItem.item.name }}</p>

        <div class="quantity-editor">
          <button
            class="quantity-arrow left-arrow"
            (click)="decrementQuantity()"
            [disabled]="tempQuantity <= 0">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <polyline points="15 18 9 12 15 6"></polyline>
            </svg>
          </button>

          <input
            type="text"
            class="quantity-input"
            [value]="tempQuantity"
            (input)="onQuantityInput($event)"
            inputmode="numeric"
            pattern="[0-9]*"
            maxlength="2"
          />

          <button
            class="quantity-arrow right-arrow"
            (click)="incrementQuantity()"
            [disabled]="tempQuantity >= 32">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <polyline points="9 18 15 12 9 6"></polyline>
            </svg>
          </button>
        </div>

        <div class="quantity-range-label">Range: 0-32</div>

        <div class="dialog-actions">
          <button class="dialog-btn cancel-btn" (click)="closeQuantityDialog()">
            Cancel
          </button>
          <button class="dialog-btn save-btn" (click)="saveQuantity()">
            Save
          </button>
        </div>
      </div>
    </div>
  }
</div>
